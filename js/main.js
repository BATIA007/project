window.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll(".catalog__tabs"),t=document.querySelector(".modals"),l=document.querySelectorAll(".modal__input"),o=document.getElementById("mobile-but");o.addEventListener("click",e=>{document.body.classList.toggle("overflow-y-hidden"),document.querySelector(".header").classList.toggle("header-active"),o.parentElement.classList.toggle("max-z-index")});for(let t of e){const e=t.querySelectorAll(".catalog__tab");for(let t of e)t.addEventListener("click",l=>{if(!t.classList.contains("catalog__tab-active")){for(let t of e)t.classList.remove("catalog__tab-active");t.classList.add("catalog__tab-active")}})}for(let e=0;e<l.length;e++)l[e].addEventListener("focus",l=>{let o=t.querySelectorAll(".modal__input-label");t.querySelectorAll(".modal__input-info")[e].classList.add("modal__svg-focus"),o[e].classList.add("hide-opacity")});for(let e=0;e<l.length;e++)l[e].addEventListener("blur",o=>{let r=t.querySelectorAll(".modal__input-label"),a=t.querySelectorAll(".modal__input-info");""===l[e].value&&r[e].classList.remove("hide-opacity"),a[e].classList.remove("modal__svg-focus")});const r=document.querySelectorAll(".catalog__buy"),a=document.querySelector(".review-open"),s=t.querySelectorAll(".modals__window"),n=t.querySelectorAll(".close-modal"),c=document.querySelector(".cart"),d=document.querySelector(".header__cart"),i=document.getElementById("cart-next"),_=document.getElementById("cart-order");let m=c.querySelector(".cart__list");const u=document.querySelectorAll(".order__next"),g=e=>{e.classList.remove("modals-active"),document.body.classList.remove("overflow-y-hidden"),setTimeout(()=>e.classList.add("scale-0"),500),e.querySelector(".modal")&&setTimeout(()=>e.querySelector(".modal__numbers").textContent=1,500)},y=e=>{s[e].classList.remove("scale-0"),s[e].classList.add("modals-active"),document.body.classList.add("overflow-y-hidden")};window.addEventListener("keydown",e=>{for(let t of s)t.classList.contains("modals-active")&&"Escape"==e.code&&g(t)});for(let e of n)e.addEventListener("click",e=>g(e.target.closest(".modals__window")));for(let e of r)e.addEventListener("click",e=>{const t=document.querySelector(".modal__main"),l=e.target.closest(".catalog__item"),o=l.dataset.serial;t.setAttribute("data-serial",o),t.querySelector(".catalog__image").setAttribute("src",l.querySelector(".catalog__image").getAttribute("src")),t.querySelector(".modal__item-title").textContent=l.querySelector(".catalog__item-title").textContent,t.querySelector(".modal__full-price").textContent=l.querySelector(".catalog__full-price").textContent,t.querySelector(".modal__discount-price").textContent=l.querySelector(".catalog__discount-price").textContent,y(0)});a&&a.addEventListener("click",e=>y(1)),d.addEventListener("click",e=>{c.classList.toggle("cart-active"),window.innerWidth<=1e3&&(document.body.classList.toggle("overflow-y-hidden"),d.classList.toggle("header__cart-active"),d.classList.toggle("max-z-index"))}),i.addEventListener("click",e=>{c.classList.remove("cart-active"),window.innerWidth<=1e3&&(document.body.classList.remove("overflow-y-hidden"),d.classList.remove("header__cart-active"),d.classList.remove("max-z-index"))}),_.addEventListener("click",e=>{y(3),c.classList.remove("cart-active"),window.innerWidth<=1e3&&(document.body.classList.remove("overflow-y-hidden"),d.classList.remove("header__cart-active"),d.classList.remove("max-z-index"))}),u.forEach(e=>e.addEventListener("click",e=>g(e.target.closest(".modals__window"))));const v=t.querySelectorAll(".modal__minus"),f=t.querySelectorAll(".modal__plus");let L=t.querySelectorAll(".modal__numbers");for(let e=0;e<v.length;e++)v[e].addEventListener("click",t=>{1==L[e].textContent?L[e].textContent=1:L[e].textContent--}),f[e].addEventListener("click",t=>{L[e].textContent++});let p=t.querySelector(".review__drag"),h=document.getElementById("fileElem");h.addEventListener("change",e=>{p.children[0].textContent="Загружено "+h.files.length+" файла(ов)."}),p.addEventListener("dragover",e=>{e.preventDefault(),p.classList.add("review__drag-over")}),p.addEventListener("dragleave",e=>{e.preventDefault(),p.classList.remove("review__drag-over")}),p.addEventListener("drop",e=>{e.preventDefault();const t=[...e.dataTransfer.files],l=new FormData;for(let e=0;e<t.length;e++)l.append("file",t[e]);p.classList.remove("review__drag-over"),p.children[0].textContent="Загружено "+t.length+" файла(ов)."});const S=document.querySelector(".catalog");if(!S.classList.contains("thankyou__catalog")){const e=S.querySelector(".catalog__items"),t=S.querySelector(".catalog__none"),l=Array.from(e.children),o=document.getElementById("show-all");let r=6,a=r;function b(){l.forEach(e=>e.classList.add("hide__catalog"));const e=l.filter(e=>S.dataset.categories.includes(e.dataset.category)),r=e.slice(0,a);r.forEach(e=>e.classList.remove("hide__catalog")),a>=e.length?o.style.display="none":o.style.display="block",0==r.length?t.style.display="block":t.style.display="none"}b(),o.addEventListener("click",()=>{l.length>=a&&(a+=r,b())});const s=S.querySelector(".catalog__categories");Array.from(s.children).forEach(e=>{e.addEventListener("click",()=>{a=r;const t=S.dataset.categories;let o;e.classList.contains("catalog__categorie-active")?(e.classList.remove("catalog__categorie-active"),o=t.replace(e.textContent.trim(),"")):(e.classList.add("catalog__categorie-active"),o=e.textContent.trim()+" "+t),S.dataset.categories=o.trim(),l.forEach(e=>{S.dataset.categories.includes(e.dataset.category)?S.dataset.categories.includes(e.dataset.category)&&e.classList.remove("hide__catalog"):e.classList.add("hide__catalog"),b()})})})}let q=document.querySelectorAll(".order__select"),x=document.getElementById("order-delivery-text");for(let e of q){let t=e.querySelectorAll(".order__option"),l=e.querySelector(".order__option-selected"),o=!1;if(l.classList.contains("select-delivery")){let e=l.querySelector(".order__option-text");x.textContent="Доставка "+e.textContent+":"}for(let r of t)r.addEventListener("click",a=>{if(r.classList.contains("order__option-selected")){let l=0;for(let r of t)r.classList.contains("order__option-selected")||o?!r.classList.contains("order__option-selected")&&o&&(e.classList.remove("max-z-index"),l=0):(e.classList.add("max-z-index"),l+=62),!r.classList.contains("order__option-selected")&&(r.style.top=l+"px");l=0,o=!o}else{l.classList.remove("order__option-selected"),r.classList.add("order__option-selected"),l=r;let a=0;for(let l of t)o?o&&(a=0,e.classList.remove("max-z-index")):(a+=62,e.classList.add("max-z-index")),l.style.top=a+"px";if(a=0,o=!o,l.classList.contains("select-delivery")){let e=l.querySelector(".order__option-text");x.textContent="Доставка "+e.textContent+":"}}})}let E={};localStorage.getItem("cartMilatex")&&(E=JSON.parse(localStorage.getItem("cartMilatex")));const C=document.querySelectorAll(".modal__to-cart"),A=(e,t,l,o,r,a=1)=>`\n                            <li data-serial = "${e}" class="order__item">\n                                <div class="order__image-container">\n                                    <img src="${t}" class="order__image">\n                                </div>\n                                <div class="order__info">\n                                    <h5 class="order__name">${l}</h5>\n                                    <p class="order__price">\n                                        <span class="order__full-price">${o}</span>\n                                        <span class="order__discounte-price">${r}</span>\n                                    </p>\n                                    <div class="order__controllers">\n                                        <div class="modal__quantity">\n                                            <span class="modal__minus">-</span>\n                                            <span class="modal__numbers cart__numbers">${a}</span>\n                                            <span class="modal__plus">+</span>\n                                        </div>\n                                        <span class="order__close">\n                                            +\n                                        </span>\n                                    </div>\n                                </div>\n                            </li>\n    `;C.forEach(e=>e.addEventListener("click",e=>(function(e){const t=e.target.closest(".modal__main"),l=t.dataset.serial,o=t.querySelector(".catalog__image").getAttribute("src"),r=t.querySelector(".modal__item-title").textContent,a=t.querySelector(".modal__full-price").textContent,s=t.querySelector(".modal__discount-price").textContent,n=t.querySelector(".modal__numbers").textContent,c={id:l,image:o,name:r,fullPrice:a,discountPrice:s,amount:n},d=Object.keys(E).length;if(E[l]=c,d===Object.keys(E).length){const e=document.querySelector(".danger");return e.classList.add("danger-active"),void setTimeout(()=>e.classList.remove("danger-active"),4e3)}m.insertAdjacentHTML("afterbegin",A(l,o,r,a,s,n)),T.insertAdjacentHTML("afterbegin",O(l,o,r,a,s,n)),g(t.closest(".modals-active")),B(),W(),localStorage.setItem("cartMilatex",JSON.stringify(E))})(e))),function(){for(let e in E){const t=E[e];let l=t.id,o=t.image,r=t.name,a=t.fullPrice,s=t.discountPrice,n=t.amount;m.insertAdjacentHTML("afterbegin",A(l,o,r,a,s,n))}}();const w=document.querySelector(".header__badge"),k=c.querySelector(".cart__amount"),I=c.querySelector(".cart__price-full"),$=document.getElementById("cart-order"),M=document.getElementById("cart-order-buy");function B(){const e=document.querySelector(".cart__none");k.textContent=m.children.length+" ШТ",w.textContent=m.children.length,m.children.length?0===m.children.length?($.classList.add("button-disabled"),$.disabled=!0,M.classList.add("button-disabled"),M.disabled=!0):(e.style.display="none",$.classList.remove("button-disabled"),$.disabled=!1,M.classList.remove("button-disabled"),M.disabled=!1):e.style.display="block",m.children.length>2?(listHeight=m.children[0].scrollHeight+m.children[1].scrollHeight,m.style.height=listHeight+"px"):m.style.height="auto";let t=0;for(let e in E)t+=Number(E[e].discountPrice.replace(/[^+\d]/g,""))*E[e].amount;t=(t=t.toString()).replace(/(\d{1,3}(?=(?:\d\d\d)+(?!\d)))/g,"$1 "),I.textContent=t+" грн",m=c.querySelector(".cart__list")}function H(e){const t=e.target.closest(".order__item"),l=t.querySelector(".modal__numbers"),o=t.dataset.serial,r=document.querySelectorAll(".order__item");for(let e of r){const t=e.querySelector(".modal__numbers");o==e.dataset.serial&&t.textContent++}E[o].amount=l.textContent;try{localStorage.setItem("cartMilatex",JSON.stringify(E))}catch(e){}B(),W()}function z(e){const t=e.target.closest(".order__item"),l=t.querySelector(".modal__numbers"),o=t.dataset.serial;if(1==l.textContent)return;const r=document.querySelectorAll(".order__item");for(let e of r){const t=e.querySelector(".modal__numbers");o==e.dataset.serial&&t.textContent--}E[o].amount=l.textContent;try{localStorage.setItem("cartMilatex",JSON.stringify(E))}catch(e){}B(),W()}function N(e){const t=e.target.closest(".order__item"),l=t.dataset.serial;t.classList.add("cart__item-delete"),t.addEventListener("transitionend",()=>{t.remove();const e=document.querySelectorAll(".order__item");for(let t of e)l==t.dataset.serial&&t.remove();delete E[l];try{localStorage.setItem("cartMilatex",JSON.stringify(E))}catch(e){}B(),W()})}B(),document.addEventListener("click",e=>{for(let t of document.querySelectorAll(".modal__plus"))e.target===t&&e.target.closest(".order__item")&&H(e)}),document.addEventListener("click",e=>{for(let t of document.querySelectorAll(".order__close"))e.target===t&&e.target.closest(".order__item")&&N(e)}),document.addEventListener("click",e=>{for(let t of document.querySelectorAll(".modal__minus"))e.target===t&&e.target.closest(".order__item")&&z(e)});const O=(e,t,l,o,r,a)=>`\n\n    <li data-serial = "${e}" class="order__item" >\n    <div class="order__image-container">\n        <img src="${t}" alt="goods" class="order__image">\n    </div>\n    <div class="order__info">\n        <h5 class="order__name">${l}</h5>\n        <p class="order__price">\n            <span class="order__full-price">${o} </span>\n            <span class="order__discounte-price">${r}</span>\n        </p>\n        <div class="order__controllers">\n            <div class="modal__quantity">\n                <span class="modal__minus">-</span>\n                <span class="modal__numbers">${a}</span>\n                <span class="modal__plus">+</span>\n            </div>\n            <span class="order__close">\n                +\n            </span>\n        </div>\n    </div>\n    </li>\n    `,P=t.querySelector(".order"),T=P.querySelector(".order__items");!function(){for(let e in E){const t=E[e];let l=t.id,o=t.image,r=t.name,a=t.fullPrice,s=t.discountPrice,n=t.amount;T.insertAdjacentHTML("afterbegin",O(l,o,r,a,s,n))}}();let j=document.getElementById("order-price"),D=P.querySelector(".order__all-price");const J=document.getElementById("order-delivery");function W(){let e;T.children.length>2?(e=T.children[0].scrollHeight+T.children[1].scrollHeight,T.style.height=e+"px",T.style.overflowY="auto"):0===T.children.length?($.classList.add("button-disabled"),$.disabled=!0,M.classList.add("button-disabled"),M.disabled=!0):(T.style.height="auto",$.classList.remove("button-disabled"),$.disabled=!1,M.classList.remove("button-disabled"),M.disabled=!1);let t=0,l=0;for(let e in E)t+=Number(E[e].discountPrice.replace(/[^+\d]/g,""))*E[e].amount;l=(l=t+Number(J.textContent.replace(/[^+\d]/g,""))).toString(),t=(t=t.toString()).replace(/(\d{1,3}(?=(?:\d\d\d)+(?!\d)))/g,"$1 "),l=l.replace(/(\d{1,3}(?=(?:\d\d\d)+(?!\d)))/g,"$1 "),j.textContent=t+" грн",D.textContent=l+" грн"}W()});
